---
page_title: "nsc_user Resource - nsc"
subcategory: ""
description: |-
  Manages a NATS JWT User
---

# nsc_user (Resource)

Manages a NATS JWT User

## Bearer Token Security Model

NATS supports two authentication modes for users:

### Standard Mode (bearer = false, default)
- **Two-factor authentication**: Client needs both JWT (public) and private key (seed)
- Client must sign a challenge to prove key ownership
- JWT can be safely exposed in logs and outputs (not a secret)
- Use the `jwt` attribute to access the token

### Bearer Mode (bearer = true)
- **Single-factor authentication**: JWT alone grants access (like an API key)
- No signature verification required
- **JWT becomes a secret credential** - must be protected
- Use the `jwt_sensitive` attribute (marked as sensitive in Terraform)

## JWT Output Attributes

The resource provides two JWT output attributes:

- **`jwt`**: Only populated when `bearer = false`. Safe to use in logs and outputs since the JWT is not a secret in standard mode.
- **`jwt_sensitive`**: Always populated, marked as Terraform sensitive. Use this for bearer tokens to prevent accidental exposure in logs.

**Important**: When `bearer = true`, the `jwt` attribute will be null. Always use `jwt_sensitive` for bearer tokens.

<!-- schema generated by tfplugindocs -->
## Schema

### Required

> **NOTE**: [Write-only arguments](https://developer.hashicorp.com/terraform/language/resources/ephemeral#write-only-arguments) are supported in Terraform 1.11 and later.

- `issuer_seed` (String, Sensitive, [Write-only](https://developer.hashicorp.com/terraform/language/resources/ephemeral#write-only-arguments)) Account seed for signing the user JWT (issuer). Never stored in state.
- `name` (String) User name
- `subject` (String) User public key (subject of the JWT)

### Optional

- `allow_pub` (List of String) Publish permissions. If not specified, inherits from account default permissions.
- `allow_pub_response` (Number) Allow publishing to reply subjects
- `allow_sub` (List of String) Subscribe permissions. If not specified, inherits from account default permissions.
- `allowed_connection_types` (List of String) Allowed connection types (STANDARD, WEBSOCKET, LEAFNODE, LEAFNODE_WS, MQTT, MQTT_WS, IN_PROCESS)
- `bearer` (Boolean) No connect challenge required for user
- `deny_pub` (List of String) Deny publish permissions. If not specified, inherits from account default permissions.
- `deny_sub` (List of String) Deny subscribe permissions. If not specified, inherits from account default permissions.
- `expires_at` (String) Absolute expiry timestamp in RFC3339 format (e.g., '2026-01-01T00:00:00Z'). Can be specified directly or computed from `expires_in`. Mutually exclusive with `expires_in`. Use this for fixed deadlines that won't change.
- `expires_in` (String) Relative expiry duration (e.g., '720h' for 30 days, '0s' for no expiry). Mutually exclusive with `expires_at`. JWT regenerates with new expiry on any resource change (rolling expiry).
- `max_data` (Number) Maximum number of bytes (-1 for unlimited)
- `max_payload` (Number) Maximum message payload in bytes (-1 for unlimited)
- `max_subscriptions` (Number) Maximum number of subscriptions (-1 for unlimited)
- `response_ttl` (String) Time limit for response permissions
- `source_network` (List of String) Source network for connection
- `starts_at` (String) Absolute start timestamp in RFC3339 format (e.g., '2025-01-01T00:00:00Z'). Can be specified directly or computed from `starts_in`. Mutually exclusive with `starts_in`. Use this for fixed start times that won't change.
- `starts_in` (String) Relative start duration (e.g., '24h' for 1 day from now, '0s' for immediately). Mutually exclusive with `starts_at`. JWT regenerates with new start time on any resource change.
- `tag` (List of String) Tags for user

### Read-Only

- `id` (String) User identifier (public key)
- `jwt` (String) Generated JWT token. Only populated when bearer = false. For bearer tokens, use jwt_sensitive instead.
- `jwt_sensitive` (String, Sensitive) Generated JWT token (always populated, marked as sensitive). Use this when bearer = true.
- `public_key` (String) User public key (same as subject)

## Example Usage

### Standard User (Two-Factor Authentication)
```terraform
# Generate keys
resource "nsc_nkey" "operator" {
  type = "operator"
}

resource "nsc_nkey" "account" {
  type = "account"
}

resource "nsc_nkey" "user" {
  type = "user"
}

# Create operator and account
resource "nsc_operator" "main" {
  name        = "MyOperator"
  subject     = nsc_nkey.operator.public_key
  issuer_seed = nsc_nkey.operator.seed
}

resource "nsc_account" "app" {
  name        = "AppAccount"
  subject     = nsc_nkey.account.public_key
  issuer_seed = nsc_nkey.operator.seed
}

# Standard user with two-factor authentication
resource "nsc_user" "service" {
  name        = "ServiceUser"
  subject     = nsc_nkey.user.public_key
  issuer_seed = nsc_nkey.account.seed

  # Permissions
  allow_pub = ["app.events.>", "app.requests.>"]
  allow_sub = ["app.responses.>", "_INBOX.>"]

  # Limits
  max_subscriptions = 100
  max_payload       = 1048576 # 1MB
}

# Access the JWT (safe to use in logs since bearer = false)
output "user_jwt" {
  value = nsc_user.service.jwt
}

# Or use jwt_sensitive if you prefer
output "user_jwt_sensitive" {
  value     = nsc_user.service.jwt_sensitive
  sensitive = true
}

# Generate credentials file for nats CLI
data "nsc_creds" "service" {
  jwt  = nsc_user.service.jwt
  seed = nsc_nkey.user.seed
}

output "user_creds" {
  value     = data.nsc_creds.service.creds
  sensitive = true
}
```

### User with Rolling Expiry (expires_in)
```terraform
# User with rolling 30-day expiry (recomputes on every change)
resource "nsc_user" "rolling_expiry" {
  name        = "RollingExpiryUser"
  subject     = nsc_nkey.user.public_key
  issuer_seed = nsc_nkey.account.seed

  # Rolling expiry - JWT expires 30 days from when it's issued
  # NOTE: This recomputes on EVERY resource change, issuing a new JWT
  # with a new 30-day expiry window
  expires_in = "720h" # 30 days

  allow_pub = ["app.>"]
  allow_sub = ["app.>"]
}

output "rolling_expiry_jwt" {
  value = nsc_user.rolling_expiry.jwt
}

output "rolling_expiry_time" {
  value       = nsc_user.rolling_expiry.expires_at
  description = "Actual expiry timestamp (changes on every update)"
}
```

### User with Fixed Deadline (expires_at)
```terraform
# User with fixed expiry date (never changes)
resource "nsc_user" "fixed_expiry" {
  name        = "FixedExpiryUser"
  subject     = nsc_nkey.user.public_key
  issuer_seed = nsc_nkey.account.seed

  # Fixed deadline - JWT always expires at this specific time
  # This timestamp stays constant even when other attributes change
  expires_at = "2026-01-01T00:00:00Z"

  allow_pub = ["app.>"]
  allow_sub = ["app.>"]
}

output "fixed_expiry_jwt" {
  value = nsc_user.fixed_expiry.jwt
}

output "fixed_expiry_time" {
  value       = nsc_user.fixed_expiry.expires_at
  description = "Fixed expiry timestamp (never changes)"
}
```

### Bearer Token User (Single-Factor Authentication)
```terraform
# Generate keys
resource "nsc_nkey" "operator" {
  type = "operator"
}

resource "nsc_nkey" "account" {
  type = "account"
}

resource "nsc_nkey" "bearer_user" {
  type = "user"
}

# Create operator and account
resource "nsc_operator" "main" {
  name        = "MyOperator"
  subject     = nsc_nkey.operator.public_key
  issuer_seed = nsc_nkey.operator.seed
}

resource "nsc_account" "app" {
  name        = "AppAccount"
  subject     = nsc_nkey.account.public_key
  issuer_seed = nsc_nkey.operator.seed
}

# Bearer token user (JWT is the credential - no private key required)
resource "nsc_user" "api_client" {
  name        = "APIClient"
  subject     = nsc_nkey.bearer_user.public_key
  issuer_seed = nsc_nkey.account.seed

  # Enable bearer mode - JWT becomes a secret
  bearer = true

  # Permissions
  allow_pub = ["api.>"]
  allow_sub = ["api.responses.>"]

  # Limits
  max_subscriptions = 10
  max_payload       = 65536 # 64KB

  # Expiry (recommended for bearer tokens)
  expires_in = "720h" # 30 days
}

# IMPORTANT: Use jwt_sensitive for bearer tokens
# The jwt attribute will be null when bearer = true
output "bearer_token" {
  value       = nsc_user.api_client.jwt_sensitive
  sensitive   = true
  description = "Bearer token - treat as secret credential"
}

# Note: Bearer tokens don't need a seed for authentication
# The JWT alone is sufficient to connect
```
